<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AWS Infra Agent Bot - AG-UI Console</title>
  <link rel="stylesheet" href="/static/app.css" />
</head>

<body>
  <!-- Login Modal Overlay -->
  <div id="loginModal" class="modal-overlay modal-active">
    <div class="modal-container login-container">
      <div class="modal-header">
        <h1>AWS Infra Agent</h1>
        <p class="modal-subtitle">Secure Infrastructure Automation</p>
      </div>
      
      <div class="modal-body">
        <div id="basicLoginForm" class="login-form" style="display: block;">
          <label for="usernameInput">Username or Email</label>
          <input 
            type="text" 
            id="usernameInput" 
            placeholder="Enter your username or email" 
            autocomplete="username"
          />
          
          <label for="passwordInput" style="margin-top: 16px;">Password</label>
          <input 
            type="password" 
            id="passwordInput" 
            placeholder="Enter your password"
            autocomplete="current-password"
          />
          
          <button id="basicLoginBtn" class="btn-primary" style="margin-top: 24px; width: 100%;">
            Sign In
          </button>
          
          <div id="loginError" class="alert-error" style="display: none; margin-top: 15px;"></div>
          <div id="loginLoading" class="loading-spinner" style="display: none; margin-top: 15px;">
            <span>Authenticating...</span>
          </div>
          
          <div class="login-divider" style="margin-top: 24px;">
            <span>or</span>
          </div>
          
          <label for="ssoProfileInput" style="margin-top: 12px; font-size: 13px; color: var(--text-muted);">SSO Profile (optional)</label>
          <input type="text" id="ssoProfileInput" placeholder="default" style="padding:8px; border-radius:8px; border:1px solid var(--border);" />

          <button id="ssoLoginBtn" class="btn-secondary" style="margin-top: 16px; width: 100%;">
            Sign In with AWS SSO (Open Terminal)
          </button>
          
          <div id="ssoStatus" style="display: none; margin-top: 14px;">
            <div id="ssoProgress" class="progress" style="height:10px; background:var(--panel-alt); border-radius:6px; overflow:hidden;">
              <div id="ssoProgressBar" style="width:0%; height:100%; background:linear-gradient(90deg,var(--brand),var(--brand-strong)); transition: width 0.3s;"></div>
            </div>
            <div id="ssoStatusText" style="margin-top:8px; font-size:13px; color:var(--text-muted);">Waiting for SSO...</div>
            <button id="ssoDoneBtn" class="btn-secondary" style="margin-top:10px;">I've completed login</button>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <p class="modal-hint">
          Secure login · Your credentials are encrypted in transit
        </p>
      </div>
    </div>
  </div>

  <div class="app-shell" id="appShell" style="display: none;">
    <header class="topbar">
      <div class="brand">
        <span class="brand-mark">AWS Infra Agent</span>
        <span class="brand-sub">AG-UI Console</span>
      </div>
      <div class="topbar-actions">
        <div class="model-picker">
          <label for="modelSelect">Model</label>
          <select id="modelSelect"></select>
        </div>
        <div class="model-picker">
          <label for="mcpSelect">MCP Server</label>
          <select id="mcpSelect">
            <option value="none">None</option>
            <option value="aws_terraform" selected>AWS Infrastructure (Terraform)</option>
          </select>
        </div>
        <div class="model-picker">
          <button id="awsConsoleBtn" class="btn-secondary">AWS Console</button>
          <button id="switchProfileBtn" class="btn-secondary">Switch Profile</button>
        </div>
        <div id="awsIdentity" class="status-pill"
          style="display: none; background: #232f3e; color: white; border: none;">
          <span id="awsAccount">AWS: ---</span>
        </div>
        <div class="profile-menu">
          <button id="profileMenuBtn" class="avatar-btn">
            <div class="avatar">PK</div>
          </button>
          <div id="profileDropdown" class="dropdown-menu" style="display: none;">
            <a href="#" id="profileViewLink">View Profile</a>
            <a href="#" id="logoutBtn">Logout</a>
          </div>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="chat-panel">
        <div class="status-row">
          <div class="status-pill">Live agent session</div>
          <div class="status-meta" id="statusMeta">Idle</div>
        </div>

        <div class="chat-stream" id="chatStream">
          <div class="message assistant">
            <div class="message-meta">Assistant</div>
            <div class="message-body">
              Welcome back. Ask me anything about AWS infra, guardrails, or deployments.
            </div>
          </div>
        </div>

        <form class="composer" id="composer">
          <div class="composer-input">
            <textarea id="promptInput" rows="1" placeholder="Search or ask a question..."></textarea>
            <button type="submit" id="sendBtn">Send</button>
          </div>
          <div class="composer-hints">
            Shift + Enter for newline · AG-UI streaming enabled
          </div>
        </form>
      </section>

      <aside class="side-panel">
        <div class="side-section">
          <h3>Quick Menu</h3>
          <ul class="menu-list">
            <li>Runbooks</li>
            <li>Stacks</li>
            <li>Credentials</li>
            <li>Audit Logs</li>
            <li>Cost Signals</li>
          </ul>
        </div>

        <div class="side-section">
          <h3>Session</h3>
          <div class="card">
            <div class="card-label">Thread</div>
            <div class="card-value" id="threadId">...</div>
          </div>
          <div class="card">
            <div class="card-label">Provider</div>
            <div class="card-value" id="providerLabel">...</div>
          </div>
          <div class="card">
            <div class="card-label">Latency</div>
            <div class="card-value" id="latencyLabel">--</div>
          </div>
        </div>

        <div class="side-section">
          <h3>Notes</h3>
          <p class="side-note">
            This UI speaks AG-UI events over SSE, giving you streaming updates, run metadata, and
            consistent agent telemetry.
          </p>
        </div>
      </aside>
    </main>
  </div>

  <script src="/static/app.js"></script>
</body>

</html>